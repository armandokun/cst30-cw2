<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="styles/styles.css">
    <script>var exports = {};</script>

    <!-- Include Plotly JavaScript library -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script defer type="module" src="js/websocket.js"></script>
    <title>CST3130 - Coursework 2</title>
</head>
<body>
<h1>Performance Metrics</h1>
<h3>Device: <b>Emotiv EPOC+</b></h3>
<h3>Contact Quality: <span class="statusGreen">100%</span></h3>
<h3>Battery: <span class="statusGreen">100%</span></h3>
<form>
    <label>
        <input type="text" name="inputString" placeholder="Enter command"/>
    </label>
    <button type="button" onclick="sendMessage()">Submit</button>
</form>

<h1>Data Received</h1>
<p
        onchange="plotData()"
        style="border-style: solid; width: 500px; border-width: 1px;"
        id="messages">
</p>

<!-- Create DIVs to hold the charts -->
<div id="engagementDiv" style="width:800px;height:400px;"></div>
<div id="excitementDiv" style="width:800px;height:400px;"></div>
<div id="stressDiv" style="width:800px;height:400px;"></div>
<div id="relaxationDiv" style="width:800px;height:400px;"></div>
<div id="interestDiv" style="width:800px;height:400px;"></div>
<div id="focusDiv" style="width:800px;height:400px;"></div>

</body>
<script>


    // Plots randomly generate crypto data
    function plotData() {
        let dataConsole = document.getElementById("messages").innerText;
        let plotlyDivContent = document.getElementById("engagementDiv").innerHTML;
        let plotlyData = JSON.parse(dataConsole);

        // if there are no diagrams drawn
        if (dataConsole !== "") {
            //Work through the available metrics
            plotlyData.forEach(metric => {
                //Specify how chart should be drawn
                let trace = {
                    x: metric.x,
                    y: metric.y,
                    mode: 'line',
                    name: metric.name,
                    marker: {
                        color: 'rgb(219, 64, 82)',
                        size: 12
                    }
                };

                //Upper case the start of the currency name and create title of chart
                let chartTitle = metric.name.charAt(0).toUpperCase() + metric.name.slice(1);

                // Chart location
                let charLocation = metric.name + "Div";

                //Set up graph
                let layout = {
                    title: chartTitle,
                    xaxis: {
                        title: 'Time'
                    },
                    yaxis: {
                        title: 'Value'
                    }
                };

                if (plotlyDivContent === "") {
                    //Plot data
                    Plotly.newPlot(charLocation, [trace], layout);
                } else {
                    // Add data
                    Plotly.extendTraces(charLocation, {x: [metric.x], y: [metric.y]}, [0]);
                }
            });
        }

    }

    // Init function every 10sec
    setInterval(plotData, 10000);

</script>
</html>

